<!DOCTYPE html>
<html>
<head>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>BuzzStats v0.5</title>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <!-- <script src="https://d3js.org/d3.v5.min.js"></script> -->
    <style>
        :root {
            --mode-green: #A5D0A8;
            --mode-red: #F76C5E;
            --gt-gold: #B3A369;
            --gt-navy: #003057;
            --def-green: #127475;
        }
        body {
            font-family: 'Open Sans', sans-serif;
        }
        .page-title {
            margin-bottom: 30px;
        }
        .player-panel {
            padding: 10px 5px;
            border: solid 1px white;
            border-radius: 5px;
            margin: 15px -10px;
            background-color: white;
        }
        .player-name-col {
            margin-bottom: 20px;
            padding-left: 10px;
        }
        .player-name {
            font-size: 1.7rem;
        }
        .player-number-col {
            margin-bottom: 20px;
            padding-left: 0;
            padding-right: 0;
        }
        .player-number {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .player-panel p {
            margin: 0;
        }


        .button-col, .number-col {
            padding: 0;
        }

        .panel-sep {
            height: 20px;
        }

        .btn-update-stat {
            background-color: var(--mode-green);
            border-color: var(--mode-green);
            color: black;
            font-weight: bold;
        }
        .btn:focus {
            box-shadow: 0 0 0 0;
        }
        .btn-update-color-col {
            margin-bottom: 20px;
            padding: 0px;

        }
        .btn-update-color {
            height: 30px;
            width: 30px;
            padding: 0px;
            margin-top: -20px;
            border-radius: 15px;
            background-color: var(--gt-gold);
            z-index: 10;
            color: var(--gt-gold);
        }
        .btn-update-color:hover {
            color: var(--gt-gold);
            border-color: var(--gt-gold);
        }
        #plus-mode-label {
            background-color: var(--mode-green);
            border-radius: 0;

        }
        #minus-mode-label {
            background-color: var(--mode-red);
            border-radius: 0;
        }

        #util-bar {
            margin-bottom: 10px;
        }

        .google-sheets-buttons button {
            margin: 5px;
            background-color: var(--gt-navy);
            border-radius: 0;
            color: white;
        }
        .google-sheets-buttons button:hover {
            background-color: var(--gt-gold);
            color: white;
        }

        #page-container {
            background-color:  var(--mode-green);
        }
    </style>
</head>
<body>
    <div class="container-fluid" id="page-container">
        <div id="util-bar">
            <div class="btn-group btn-group-toggle mode-toggle" data-toggle="buttons">
                <label class="btn" id="plus-mode-label" for="plus-mode"><input type="radio" id="plus-mode" name="mode" onclick="changeMode('plus')" checked>+ Mode</label>
                <label class="btn" id="minus-mode-label" for="minus-mode"><input type="radio" id="minus-mode" name="mode" onclick="changeMode('minus')" >- Mode</label>
            </div>
            <div class="btn-group float-right google-sheets-buttons">
                <button class="btn" id="authorize_button" style="display: none;">Authorize</button>
                <button class="btn" id="signout_button" style="display: none;">Sign Out</button>
                <button class="btn" onclick="uploadToGoogleSheets()">Upload To Google Sheets</button>
            </div>
        </div>

        <div class="row title justify-content-center">
            <div class="col-12 text-center">
                <h1 class="page-title">BuzzStats v1.0</h1>
            </div>
        </div>
        <div class="row justify-content-center" id="main-titles">
        </div>
        <div class="row justify-content-center" id="main-cols">
        </div>


    </div>

    <!-- Google Sheets API -->
    <script type="text/javascript">
      // Client ID and API key from the Developer Console
      var CLIENT_ID = '397646043092-nbjku2gai8rfiea37u9o14hn05j40hrk.apps.googleusercontent.com';
      var API_KEY = 'AIzaSyCZV77t3Ana01JOFX5RHCuXykrzDRNjrXg';

      // Array of API discovery doc URLs for APIs used by the quickstart
      var DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];

      // Authorization scopes required by the API; multiple scopes can be
      // included, separated by spaces.
      var SCOPES = "https://www.googleapis.com/auth/spreadsheets";

      var authorizeButton = document.getElementById('authorize_button');
      var signoutButton = document.getElementById('signout_button');

      /**
       *  On load, called to load the auth2 library and API client library.
       */
      function handleClientLoad() {
        gapi.load('client:auth2', initClient);
      }

      /**
       *  Initializes the API client library and sets up sign-in state
       *  listeners.
       */
      function initClient() {
        gapi.client.init({
          apiKey: API_KEY,
          clientId: CLIENT_ID,
          discoveryDocs: DISCOVERY_DOCS,
          scope: SCOPES
        }).then(function () {
          // Listen for sign-in state changes.
          gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

          // Handle the initial sign-in state.
          updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
          authorizeButton.onclick = handleAuthClick;
          signoutButton.onclick = handleSignoutClick;
        }, function(error) {
          appendPre(JSON.stringify(error, null, 2));
        });
      }

      /**
       *  Called when the signed in status changes, to update the UI
       *  appropriately. After a sign-in, the API is called.
       */
      function updateSigninStatus(isSignedIn) {
        if (isSignedIn) {
          authorizeButton.style.display = 'none';
          signoutButton.style.display = 'block';
        } else {
          authorizeButton.style.display = 'block';
          signoutButton.style.display = 'none';
        }
      }

      /**
       *  Sign in the user upon button click.
       */
      function handleAuthClick(event) {
        gapi.auth2.getAuthInstance().signIn();
      }

      /**
       *  Sign out the user upon button click.
       */
      function handleSignoutClick(event) {
        gapi.auth2.getAuthInstance().signOut();
      }

      /**
       * Append a pre element to the body containing the given message
       * as its text node. Used to display the results of the API call.
       *
       * @param {string} message Text to be placed in pre element.
       */
      function appendPre(message) {
        var pre = document.getElementById('content');
        var textContent = document.createTextNode(message + '\n');
        pre.appendChild(textContent);
      }
  </script>

    <script>
        window.onbeforeunload = function ()
        {
            return "";
        };

        var players = [];
        var playerKills = Array.apply(null, new Array(30)).map(Number.prototype.valueOf,0);
        var playerErrors = Array.apply(null, new Array(30)).map(Number.prototype.valueOf,0);
        var playerAttempts = Array.apply(null, new Array(30)).map(Number.prototype.valueOf,0);
        var playerPasses3 = Array.apply(null, new Array(30)).map(Number.prototype.valueOf,0);
        var playerPasses2 = Array.apply(null, new Array(30)).map(Number.prototype.valueOf,0);
        var playerPasses1 = Array.apply(null, new Array(30)).map(Number.prototype.valueOf,0);
        var playerPasses0 = Array.apply(null, new Array(30)).map(Number.prototype.valueOf,0);

        players[2] = 'Dom';
        players[3] = 'Savannah';
        players[5] = 'Grace R.';
        players[6] = 'Maddie';
        players[7] = 'Liz';
        players[9] = 'Grace M.';
        players[10] = 'Bella';
        players[11] = 'Breland';
        players[13] = 'Mari';
        players[14] = 'Cori';
        players[17] = 'Julia';
        players[22] = 'Matti';
        players[23] = 'Erin';
        players[24] = 'Mikaila';
        players[25] = 'Kayla';
        // players[26] = 'Player1';
        // players[27] = 'Player2';
        // players[28] = 'Player3';

        var outsides = [2, 3, 13];
        var outsides2 = [17, 24];
        var opposites = [5, 9, 14];
        var middles = [11, 23, 25];
        var setters = [10, 22];
        var liberos = [6, 7];

        var titles = ['OH', '', 'RS', 'MB', 'S', 'L/DS'];
        var cols = ['outsides', 'outsides2', 'opposites', 'middles', 'setters', 'liberos'];

        addMainFrame();
        players.forEach(addPlayer);

        function addMainFrame() {
            mainTitles = "";
            mainCols = "";

            for (var i = 0; i < 6; i++) {
                mainTitles += '<div class="col-6 col-md-4 col-lg-2 text-center">';
                mainTitles += '<h3>' + titles[i] + '</h3>';
                mainTitles += '</div>';

                mainCols += '<div class="col-6 col-md-4 col-lg-2">';
                mainCols += '<div class="row" id="' + titles[i] + '">';
                mainCols += '<div class="col text-center" id="' + cols[i] + '-col">';
                mainCols += '</div>';
                mainCols += '</div>';
                mainCols += '</div>';
            }
            document.getElementById("main-titles").insertAdjacentHTML('beforeend', mainTitles);
            document.getElementById("main-cols").insertAdjacentHTML('beforeend', mainCols);
        }

        function addPlayer(playerName, playerNum) {
            playerDiv = "<div class='row player-panel align-items-center' id='player-" + playerNum + "'>";
                playerDiv += "<div class='col-2 btn-update-color-col'>";
                    playerDiv += "<button class='btn btn-update-color' onclick='changeColor(" + playerNum + ")' id='color-btn-" + playerNum + "'>W</button>";
                playerDiv += "</div>";
                playerDiv += "<div class='col-2 player-number-col text-right'>";
                    playerDiv += "<h4 class='player-number' id='number-" + playerNum + "'>" + playerNum + "</h4>";
                playerDiv += "</div>";
                playerDiv += "<div class='col-8 player-name-col  text-left'>";
                    playerDiv += "<h4 class='player-name' id='name-" + playerNum + "'>" + playerName + "</h4>";
                playerDiv += "</div>";
                playerDiv += "<div class='col-2 button-col'>";
                    playerDiv += "<button class='btn btn-update-stat btn-dark' onclick='changeKills(" + playerNum + ")'>K</button>";
                playerDiv += "</div>";
                playerDiv += "<div class='col-2 number-col'>";
                    playerDiv += "<p id='kills-" + playerNum + "'>" + playerKills[playerNum] + "</p>";
                playerDiv += "</div>";

                playerDiv += "<div class='col-2 button-col'>";
                    playerDiv += "<button class='btn btn-update-stat btn-dark' onclick='changeErrors(" + playerNum + ")'>E</button>";
                playerDiv += "</div>";
                playerDiv += "<div class='col-2 number-col'>";
                    playerDiv += "<p id='errors-" + playerNum + "'>" + playerErrors[playerNum] + "</p>";
                playerDiv += "</div>";

                playerDiv += "<div class='col-2 button-col'>";
                    playerDiv += "<button class='btn btn-update-stat btn-dark' onclick='changeAttempts(" + playerNum + ")'>A</button>";
                playerDiv += "</div>";
                playerDiv += "<div class='col-2 number-col'>";
                    playerDiv += "<p id='attempts-" + playerNum + "'>" + playerAttempts[playerNum] + "</p>";
                playerDiv += "</div>";

                playerDiv += "<div class='panel-sep col-12'>";
                playerDiv += "</div>";

                playerDiv += "<div class='col-4 text-right'>";
                    playerDiv += "<p>Pass: </p>";
                playerDiv += "</div>";
                playerDiv += "<div class='col-8'>";
                    playerDiv += "<div class='row'>";
                        playerDiv += "<div class='col-3 button-col'>";
                            playerDiv += "<button class='btn btn-update-stat btn-dark' onclick='changePasses3(" + playerNum + ")'>3</button>";
                        playerDiv += "</div>";
                        playerDiv += "<div class='col-3 button-col'>";
                            playerDiv += "<button class='btn btn-update-stat btn-dark' onclick='changePasses2(" + playerNum + ")'>2</button>";
                        playerDiv += "</div>";
                        playerDiv += "<div class='col-3 button-col'>";
                            playerDiv += "<button class='btn btn-update-stat btn-dark' onclick='changePasses1(" + playerNum + ")'>1</button>";
                        playerDiv += "</div>";
                        playerDiv += "<div class='col-3 button-col'>";
                            playerDiv += "<button class='btn btn-update-stat btn-dark' onclick='changePasses0(" + playerNum + ")'>0</button>";
                        playerDiv += "</div>";

                        playerDiv += "<div class='col-3 number-col'>";
                            playerDiv += "<p id='passes3-" + playerNum + "'>" + playerPasses3[playerNum] + "</p>";
                        playerDiv += "</div>";
                        playerDiv += "<div class='col-3 number-col'>";
                            playerDiv += "<p id='passes2-" + playerNum + "'>" + playerPasses2[playerNum] + "</p>";
                        playerDiv += "</div>";
                        playerDiv += "<div class='col-3 number-col'>";
                            playerDiv += "<p id='passes1-" + playerNum + "'>" + playerPasses1[playerNum] + "</p>";
                        playerDiv += "</div>";
                        playerDiv += "<div class='col-3 number-col'>";
                            playerDiv += "<p id='passes0-" + playerNum + "'>" + playerPasses0[playerNum] + "</p>";
                        playerDiv += "</div>";
                    playerDiv += "</div>";
                playerDiv += "</div>";
            playerDiv += "</div>";

            if (outsides.includes(playerNum)) {
                document.getElementById("outsides-col").insertAdjacentHTML('beforeend', playerDiv);
            } else if (outsides2.includes(playerNum)) {
                document.getElementById("outsides2-col").insertAdjacentHTML('beforeend', playerDiv);
            } else if (opposites.includes(playerNum)) {
                document.getElementById("opposites-col").insertAdjacentHTML('beforeend', playerDiv);
            } else if (middles.includes(playerNum)) {
                document.getElementById("middles-col").insertAdjacentHTML('beforeend', playerDiv);
            } else if (setters.includes(playerNum)) {
                document.getElementById("setters-col").insertAdjacentHTML('beforeend', playerDiv);
            } else if (liberos.includes(playerNum)) {
                document.getElementById("liberos-col").insertAdjacentHTML('beforeend', playerDiv);
            } else {
                // document.getElementById("others-col").insertAdjacentHTML('beforeend', playerDiv);
            }
        }

        function changeMode(mode) {
            var all_stat_btns = document.getElementsByClassName('btn-update-stat');
            if(mode == "plus") {
                document.getElementById("page-container").style.backgroundColor = "var(--mode-green)";
                for (var i = 0; i < all_stat_btns.length; i++) {
                    all_stat_btns[i].style.backgroundColor =  "var(--mode-green)";
                }
            } else if(mode == "minus") {
                document.getElementById("page-container").style.backgroundColor = "var(--mode-red)";
                for (var i = 0; i < all_stat_btns.length; i++) {
                    all_stat_btns[i].style.backgroundColor =  "var(--mode-red)";
                }
            }
        }

        function changeColor(playerNum) {
            btn_id = "color-btn-" +  playerNum;
            panel_id = "player-" +  playerNum;
            if (document.getElementById(btn_id).innerHTML == "W") {
                document.getElementById(btn_id).innerHTML = "G";
                document.getElementById(btn_id).style.color = "var(--gt-navy)";
                document.getElementById(btn_id).style.backgroundColor = "var(--gt-navy)";
                document.getElementById(panel_id).style.backgroundColor = "var(--gt-gold)";
                document.getElementById(panel_id).style.borderColor = "var(--gt-gold)";
                document.getElementById(panel_id).style.color = "black";
            } else if (document.getElementById(btn_id).innerHTML == "G") {
                document.getElementById(btn_id).innerHTML = "N";
                document.getElementById(btn_id).style.color = "white";
                document.getElementById(btn_id).style.backgroundColor = "white";
                document.getElementById(panel_id).style.backgroundColor = "var(--gt-navy)";
                document.getElementById(panel_id).style.borderColor = "var(--gt-navy)";
                document.getElementById(panel_id).style.color = "white";
            } else if (document.getElementById(btn_id).innerHTML == "N") {
                document.getElementById(btn_id).innerHTML = "W";
                document.getElementById(btn_id).style.color = "var(--gt-gold)";
                document.getElementById(btn_id).style.backgroundColor = "var(--gt-gold)";
                document.getElementById(panel_id).style.backgroundColor = "white";
                document.getElementById(panel_id).style.borderColor = "white";
                document.getElementById(panel_id).style.color = "black";
            }
        }

        function changeKills(playerNum) {
            var kills = playerKills[playerNum];
            if (document.getElementById("plus-mode").checked) {
                kills++;
            } else {
                kills--;
            }
            playerKills[playerNum] = kills;

            id_name = "kills-" +  playerNum
            document.getElementById(id_name).innerHTML = kills;
        }

        function changeErrors(playerNum) {
            var errors = playerErrors[playerNum];
            if (document.getElementById("plus-mode").checked) {
                errors++;
            } else {
                errors--;
            }
            playerErrors[playerNum] = errors;

            id_name = "errors-" +  playerNum
            document.getElementById(id_name).innerHTML = errors;
        }

        function changeAttempts(playerNum) {
            var attempts = playerAttempts[playerNum];
            if (document.getElementById("plus-mode").checked) {
                attempts++;
            } else {
                attempts--;
            }
            playerAttempts[playerNum] = attempts;

            id_name = "attempts-" +  playerNum
            document.getElementById(id_name).innerHTML = attempts;
        }

        function changePasses3(playerNum) {
            var passes3 = playerPasses3[playerNum];
            if (document.getElementById("plus-mode").checked) {
                passes3++;
            } else {
                passes3--;
            }
            playerPasses3[playerNum] = passes3;

            id_name = "passes3-" +  playerNum
            document.getElementById(id_name).innerHTML = passes3;
        }
        function changePasses2(playerNum) {
            var passes2 = playerPasses2[playerNum];
            if (document.getElementById("plus-mode").checked) {
                passes2++;
            } else {
                passes2--;
            }
            playerPasses2[playerNum] = passes2;

            id_name = "passes2-" +  playerNum
            document.getElementById(id_name).innerHTML = passes2;
        }
        function changePasses1(playerNum) {
            var passes1 = playerPasses1[playerNum];
            if (document.getElementById("plus-mode").checked) {
                passes1++;
            } else {
                passes1--;
            }
            playerPasses1[playerNum] = passes1;

            id_name = "passes1-" +  playerNum
            document.getElementById(id_name).innerHTML = passes1;
        }
        function changePasses0(playerNum) {
            var passes0 = playerPasses0[playerNum];
            if (document.getElementById("plus-mode").checked) {
                passes0++;
            } else {
                passes0--;
            }
            playerPasses0[playerNum] = passes0;

            id_name = "passes0-" +  playerNum
            document.getElementById(id_name).innerHTML = passes0;
        }

        function uploadToGoogleSheets() {
            if (gapi.auth2.getAuthInstance().isSignedIn.get()) {
                var template;
                var spreadsheetId = '1vSH3PCElo6FzTzNjcjC7DNXkf2FynwCoeffhDdKMX7U';
                var body;

                var values;

                gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: spreadsheetId,
                    range: 'Template!A1:O19',
                    valueRenderOption: 'FORMULA',
                }).then(function(response) {
                    template = response.result;
                    // template.values[template.values.length+1] = [""];
                    // template.values[template.values.length+2] = [""];
                    tableValues = template.values;
                    console.log(tableValues);

                    for (var i = 2; i < template.values.length; i++) {
                        var currNum = tableValues[i][1];
                        tableValues[i][3] = playerKills[currNum];
                        tableValues[i][4] = playerErrors[currNum];
                        tableValues[i][5] = playerAttempts[currNum] + playerKills[currNum] + playerErrors[currNum];
                        tableValues[i][7] = playerPasses3[currNum];
                        tableValues[i][8] = playerPasses2[currNum];
                        tableValues[i][9] = playerPasses1[currNum];
                        tableValues[i][10] = playerPasses0[currNum];
                        tableValues[i][14] = document.getElementById("color-btn-" +  currNum).innerHTML;
                    }
                    tableValues[template.values.length+1] = [""];
                    tableValues[template.values.length+2] = [""];

                    gapi.client.sheets.spreadsheets.values.append({
                        spreadsheetId: spreadsheetId,
                        range: 'Test!A1',
                        valueInputOption: 'USER_ENTERED',
                        // valueInputOption: 'RAW',
                        insertDataOption: 'INSERT_ROWS',
                        resource: { values: tableValues }
                    }).then((response) => {
                        var result = response.result;
                        console.log(result)
                        console.log(`${result.updates.updatedCells} cells updated.`);
                    });
                });

            }
        }
    </script>

    <script async defer src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>

</body>
</html>
